let currentQuestion = 0;
let score = { tamil: 0, hindi: 0, french: 0 };
let selectedSet = [];
let totalQuestions = 10;

const correctSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
const wrongSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
const wordList = [
  { word: "apple", tamil: "роЖрокрпНрокро┐ро│рпН", hindi: "рд╕реЗрдм", french: "Pomme", category: "objects" },
  { word: "dog", tamil: "роиро╛ропрпН", hindi: "рдХреБрддреНрддрд╛", french: "Chien", category: "animals" },
  { word: "run", tamil: "роУроЯрпБ", hindi: "рджреМрдбрд╝рдирд╛", french: "Courir", category: "actions" },
  { word: "cat", tamil: "рокрпВройрпИ", hindi: "рдмрд┐рд▓реНрд▓реА", french: "Chat", category: "animals" },
  { word: "sun", tamil: "роЪрпВро░ро┐ропройрпН", hindi: "рд╕реВрд░рдЬ", french: "Soleil", category: "objects" },
  { word: "milk", tamil: "рокро╛ро▓рпН", hindi: "рджреВрдз", french: "Lait", category: "objects" },
  { word: "jump", tamil: "родро╛ро╡рпБ", hindi: "рдХреВрджрдирд╛", french: "Sauter", category: "actions" },
  { word: "fish", tamil: "роорпАройрпН", hindi: "рдордЫрд▓реА", french: "Poisson", category: "animals" },
  { word: "flower", tamil: "рооро▓ро░рпН", hindi: "рдлреВрд▓", french: "Fleur", category: "objects" },
  { word: "sleep", tamil: "родрпВроЩрпНроХрпБ", hindi: "рд╕реЛрдирд╛", french: "Dormir", category: "actions" },
  { word: "banana", tamil: "ро╡ро╛ро┤рпИ", hindi: "рдХреЗрд▓рд╛", french: "Banane", category: "objects" },
  { word: "cow", tamil: "рокроЪрпБ", hindi: "рдЧрд╛рдп", french: "Vache", category: "animals" },
  { word: "read", tamil: "рокроЯро┐", hindi: "рдкрдврд╝рдирд╛", french: "Lire", category: "actions" },
  { word: "book", tamil: "рокрпБродрпНродроХроорпН", hindi: "рдХрд┐рддрд╛рдм", french: "Livre", category: "objects" },
  { word: "elephant", tamil: "ропро╛ройрпИ", hindi: "рд╣рд╛рдереА", french: "├Йl├йphant", category: "animals" },
  { word: "write", tamil: "роОро┤рпБродрпБ", hindi: "рд▓рд┐рдЦрдирд╛", french: "├Йcrire", category: "actions" },
  { word: "car", tamil: "роХро╛ро░рпН", hindi: "рдЧрд╛рдбрд╝реА", french: "Voiture", category: "objects" },
  { word: "lion", tamil: "роЪро┐роЩрпНроХроорпН", hindi: "рд╕рд┐рдВрд╣", french: "Lion", category: "animals" },
  { word: "climb", tamil: "роПро▒рпБ", hindi: "рдЪрдврд╝рдирд╛", french: "Grimper", category: "actions" },
  { word: "pen", tamil: "рокрпЗройро╛", hindi: "рдХрд▓рдо", french: "Stylo", category: "objects" },
  { word: "mouse", tamil: "роОро▓ро┐", hindi: "рдЪреВрд╣рд╛", french: "Souris", category: "animals" },
  { word: "phone", tamil: "родрпКро▓рпИрокрпЗроЪро┐", hindi: "рдлреЛрди", french: "T├йl├йphone", category: "objects" },
  { word: "dance", tamil: "роироЯройроорпН", hindi: "рдиреГрддреНрдп", french: "Danse", category: "actions" },
  { word: "bird", tamil: "рокро▒ро╡рпИ", hindi: "рдкрдХреНрд╖реА", french: "Oiseau", category: "animals" },
  { word: "ball", tamil: "рокроирпНродрпБ", hindi: "рдЧреЗрдВрдж", french: "Balle", category: "objects" },
  { word: "play", tamil: "ро╡ро┐ро│рпИропро╛роЯрпБ", hindi: "рдЦреЗрд▓рдирд╛", french: "Jouer", category: "actions" },
  { word: "bear", tamil: "роХро░роЯро┐", hindi: "рднрд╛рд▓реВ", french: "Ours", category: "animals" },
  { word: "table", tamil: "роорпЗроЪрпИ", hindi: "рдореЗрдЬрд╝", french: "Table", category: "objects" },
  { word: "eat", tamil: "роЪро╛рокрпНрокро┐роЯрпБ", hindi: "рдЦрд╛рдирд╛", french: "Manger", category: "actions" },
  { word: "tiger", tamil: "рокрпБро▓ро┐", hindi: "рдмрд╛рдШ", french: "Tigre", category: "animals" },
  { word: "chair", tamil: "роиро╛ро▒рпНроХро╛ро▓ро┐", hindi: "рдХреБрд░реНрд╕реА", french: "Chaise", category: "objects" },
  { word: "think", tamil: "роЪро┐роирпНродро┐", hindi: "рд╕реЛрдЪрдирд╛", french: "Penser", category: "actions" },
  { word: "monkey", tamil: "роХрпБро░роЩрпНроХрпБ", hindi: "рдмрдВрджрд░", french: "Singe", category: "animals" },
  { word: "bottle", tamil: "роХрпБроЯроорпН", hindi: "рдмреЛрддрд▓", french: "Bouteille", category: "objects" },
  { word: "walk", tamil: "роироЯ", hindi: "рдЪрд▓рдирд╛", french: "Marcher", category: "actions" },
  { word: "goat", tamil: "роЖроЯрпБ", hindi: "рдмрдХрд░реА", french: "Ch├иvre", category: "animals" },
  { word: "spoon", tamil: "роХро░рогрпНроЯро┐", hindi: "рдЪрдореНрдордЪ", french: "Cuill├иre", category: "objects" },
  { word: "draw", tamil: "ро╡ро░рпИ", hindi: "рдЪрд┐рддреНрд░ рдмрдирд╛рдирд╛", french: "Dessiner", category: "actions" },
  { word: "deer", tamil: "рооро╛ройрпН", hindi: "рд╣рд┐рд░рди", french: "Cerf", category: "animals" },
  { word: "fan", tamil: "роХро╛ро▒рпНро▒ро╛роЯро┐", hindi: "рдкрдВрдЦрд╛", french: "Ventilateur", category: "objects" },
  { word: "cry", tamil: "роЕро┤рпБ", hindi: "рд░реЛрдирд╛", french: "Pleurer", category: "actions" },
  { word: "duck", tamil: "ро╡ро╛родрпНродрпБ", hindi: "рдмрддрдЦ", french: "Canard", category: "animals" },
  { word: "train", tamil: "ро░ропро┐ро▓рпН", hindi: "рд░реЗрд▓рдЧрд╛рдбрд╝реА", french: "Train", category: "objects" },
  { word: "cook", tamil: "роЪроорпИ", hindi: "рдкрдХрд╛рдирд╛", french: "Cuisiner", category: "actions" },
  { word: "rabbit", tamil: "роорпБропро▓рпН", hindi: "рдЦрд░рдЧреЛрд╢", french: "Lapin", category: "animals" },
  { word: "television", tamil: "родрпКро▓рпИроХрпНроХро╛роЯрпНроЪро┐", hindi: "рдЯреАрд╡реА", french: "T├йl├йvision", category: "objects" },
  { word: "swim", tamil: "роорпВро┤рпНроХро▓рпН", hindi: "рддреИрд░рдирд╛", french: "Nager", category: "actions" }
];

function speakWord(word, langCode = 'en-IN') {
  const synth = window.speechSynthesis;
  let voices = synth.getVoices();
  const utter = new SpeechSynthesisUtterance(word);
  const voice = voices.find(v => v.lang === langCode || v.lang.includes(langCode.slice(0, 2)));
  if (voice) utter.voice = voice;
  utter.lang = langCode;
  synth.speak(utter);
}



function endGame(userName) {
  const total = score.tamil + score.hindi + score.french;
  let message = "", animId = "", bg = "#fff";

  if (total === totalQuestions * 3) {
    message = `ЁЯОЙ Excellent, ${userName}! You got all correct!`;
    animId = "winAnim"; bg = "#d4edda";
  } else if (total >= totalQuestions * 2) {
    message = `ЁЯСН Great job, ${userName}! Keep it up!`;
    animId = "goodAnim"; bg = "#fff3cd";
  } else {
    message = `ЁЯТк Try again, ${userName}! Practice makes perfect.`;
    animId = "tryAnim"; bg = "#f8d7da";
  }

  document.getElementById("winAnim").style.display = "none";
  document.getElementById("goodAnim").style.display = "none";
  document.getElementById("tryAnim").style.display = "none";
  if (animId) document.getElementById(animId).style.display = "block";

  document.getElementById("result").innerHTML = `
    <div style="background: ${bg}; border: 2px solid #ccc; padding: 1rem; border-radius: 10px; margin-top: 1rem;">
      <h3>${message}</h3>
      <p>тЬЕ Tamil: ${score.tamil} / ${totalQuestions}<br>ЁЯЗоЁЯЗ│ Hindi: ${score.hindi} / ${totalQuestions}<br>ЁЯЗлЁЯЗ╖ French: ${score.french} / ${totalQuestions}</p>
      <strong>Total Score: ${total} / ${totalQuestions * 3}</strong>
    </div>
  `;
}

function checkAnswer(lang, selectedWord, correctWord, buttonEl) {
  const langCodes = { tamil: 'ta-IN', hindi: 'hi-IN', french: 'fr-FR' };
  speakWord(selectedWord, langCodes[lang]);

  const buttons = document.querySelectorAll(`#${lang}Options button`);
  buttons.forEach(btn => {
    btn.disabled = true;
    btn.classList.remove("correct", "wrong");
    if (btn.textContent === correctWord) btn.classList.add("correct");
    else if (btn.textContent === selectedWord) btn.classList.add("wrong");
  });

  if (selectedWord === correctWord) {
    score[lang]++;
    correctSound.play();
  } else {
    wrongSound.play();
  }

  if (lang === "french") {
    setTimeout(() => {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        loadQuestion();
      } else {
        const userName = document.getElementById("username").value || "Player";
        endGame(userName);
      }
    }, 1500);
  }

  updateScoreBox();
}

function createOptions(containerId, lang, correctAnswer) {
  const options = new Set([correctAnswer]);
  while (options.size < 3) {
    const rand = wordList[Math.floor(Math.random() * wordList.length)][lang];
    options.add(rand);
  }

  const container = document.getElementById(containerId);
  container.innerHTML = "";
  Array.from(options).sort(() => 0.5 - Math.random()).forEach(opt => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.onclick = () => checkAnswer(lang, opt, correctAnswer, btn);
    container.appendChild(btn);
  });
}

function loadQuestion() {
  const current = selectedSet[currentQuestion];
  document.getElementById("randomWord").innerText = `Translate: ${current.word}`;
  createOptions("tamilOptions", "tamil", current.tamil);
  createOptions("hindiOptions", "hindi", current.hindi);
  createOptions("frenchOptions", "french", current.french);
}

function startGame() {
  currentQuestion = 0;
  score = { tamil: 0, hindi: 0, french: 0 };
  selectedSet = [];

  const category = document.getElementById("category").value;
  const difficulty = document.getElementById("difficulty").value;
  totalQuestions = parseInt(document.getElementById("numQuestions").value);

  let filtered = category === "all" ? [...wordList] : wordList.filter(w => w.category === category);
  if (filtered.length < totalQuestions) {
    alert("Not enough words. Showing fewer questions.");
    totalQuestions = filtered.length;
  }

  const shuffled = filtered.sort(() => 0.5 - Math.random());
  selectedSet = shuffled.slice(0, totalQuestions);

  document.getElementById("result").innerHTML = "";
  document.getElementById("winAnim").style.display = "none";
  document.getElementById("goodAnim").style.display = "none";
  document.getElementById("tryAnim").style.display = "none";

  loadQuestion();
  updateScoreBox();
}

function restartGame() {
  document.getElementById("username").value = "";
  document.getElementById("category").value = "all";
  document.getElementById("difficulty").value = "easy";
  document.getElementById("numQuestions").value = "10";
  document.getElementById("randomWord").innerText = "";
  document.getElementById("tamilOptions").innerHTML = "";
  document.getElementById("hindiOptions").innerHTML = "";
  document.getElementById("frenchOptions").innerHTML = "";
  document.getElementById("result").innerHTML = "";
  document.getElementById("score").innerHTML = "";
  document.getElementById("winAnim").style.display = "none";
  document.getElementById("goodAnim").style.display = "none";
  document.getElementById("tryAnim").style.display = "none";
}
